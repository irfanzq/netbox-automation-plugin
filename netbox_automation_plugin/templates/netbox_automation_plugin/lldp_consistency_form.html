{% extends 'base/layout.html' %}
{% load i18n %}
{% load form_helpers %}

{% block title %}{% trans "LLDP Consistency Check" %}{% endblock %}

{% block content %}
<style>
  /* Dark mode compatibility for LLDP Consistency Form */
  .form-label,
  .form-check-label {
    color: var(--nbx-color-fg-default, #212529) !important;
  }
  
  .form-text,
  .text-muted {
    color: var(--nbx-color-fg-muted, #6c757d) !important;
  }
  
  .form-control,
  .form-select,
  select.form-control,
  select.form-select,
  textarea.form-control {
    background-color: var(--nbx-color-bg-input, #fff) !important;
    color: var(--nbx-color-fg-input, #212529) !important;
    border-color: var(--nbx-color-border-input, #ced4da) !important;
  }
  
  .form-control::placeholder {
    color: var(--nbx-color-fg-muted, #6c757d) !important;
    opacity: 0.7;
  }
  
  .form-control:focus,
  .form-select:focus,
  select.form-control:focus,
  select.form-select:focus,
  textarea.form-control:focus {
    background-color: var(--nbx-color-bg-input, #fff) !important;
    color: var(--nbx-color-fg-input, #212529) !important;
    border-color: var(--nbx-color-border-input-focus, #86b7fe) !important;
  }
  
  /* Checkbox and radio button styling for dark mode */
  .form-check-input {
    background-color: var(--nbx-color-bg-input, #fff) !important;
    border-color: var(--nbx-color-border-input, #ced4da) !important;
  }
  
  .form-check-input:checked {
    background-color: var(--nbx-color-primary, #0d6efd) !important;
    border-color: var(--nbx-color-primary, #0d6efd) !important;
  }
  
  .form-check-input:focus {
    border-color: var(--nbx-color-border-input-focus, #86b7fe) !important;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }
  
  .form-check-label {
    color: var(--nbx-color-fg-default, #212529) !important;
  }
  
  /* Datalist dropdown styling */
  datalist option {
    background-color: var(--nbx-color-bg-input, #fff) !important;
    color: var(--nbx-color-fg-input, #212529) !important;
  }
  
  /* Select dropdown options */
  select option {
    background-color: var(--nbx-color-bg-input, #fff) !important;
    color: var(--nbx-color-fg-input, #212529) !important;
  }
  
  .invalid-feedback {
    color: var(--nbx-color-danger, #dc3545) !important;
  }
  
  .alert-danger {
    background-color: var(--nbx-color-bg-danger-subtle, #f8d7da) !important;
    color: var(--nbx-color-fg-danger, #721c24) !important;
    border-color: var(--nbx-color-border-danger, #f5c2c7) !important;
  }
  
  /* Loading overlay - dark mode compatible */
  #loading-overlay {
    background: rgba(0, 0, 0, 0.7) !important;
  }
  
  #loading-overlay > div {
    background: var(--nbx-color-bg-default, #fff) !important;
    color: var(--nbx-color-fg-default, #212529) !important;
  }
  
  #loading-overlay h4 {
    color: var(--nbx-color-fg-default, #212529) !important;
  }
  
  #loading-overlay .text-muted {
    color: var(--nbx-color-fg-muted, #6c757d) !important;
  }
</style>
  <div class="row">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">{% trans "LLDP Consistency Check" %}</h5>
        </div>
        <div class="card-body">
          <p class="text-muted">
            {% trans "Select devices (by filters or explicit list) and run a read-only LLDP consistency check between device configuration, device LLDP data, and NetBox." %}
          </p>

          {% if form.non_field_errors %}
            <div class="alert alert-danger" role="alert">
              {{ form.non_field_errors }}
            </div>
          {% endif %}

          <!-- Loading overlay -->
          <div id="loading-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; align-items: center; justify-content: center;">
            <div style="background: var(--nbx-color-bg-default, #fff); padding: 30px; border-radius: 8px; text-align: center; max-width: 400px; color: var(--nbx-color-fg-default, #212529);">
              <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">Loading...</span>
              </div>
              <h4 style="color: var(--nbx-color-fg-default, #212529);">Running LLDP Consistency Check...</h4>
              <p class="text-muted mb-0" style="color: var(--nbx-color-fg-muted, #6c757d);">Collecting LLDP data from devices. This may take some time.</p>
            </div>
          </div>

          <form method="post" id="lldp-form">
            {% csrf_token %}
            {% render_form form %}

            <div class="mt-3">
              <button type="submit" class="btn btn-primary" id="run-check-btn" name="run_check" value="1">
                <i class="mdi mdi-magnify"></i>
                {% trans "Run Check" %}
              </button>
              <button type="submit" name="export_csv" value="1" class="btn btn-secondary" id="run-csv-btn">
                <i class="mdi mdi-download"></i>
                {% trans "Run & Download CSV" %}
              </button>
            </div>
          </form>

          <script>
            document.getElementById('lldp-form').addEventListener('submit', function(e) {
              // Show loading overlay
              const overlay = document.getElementById('loading-overlay');
              overlay.style.display = 'flex';
              
              // Disable form buttons
              document.getElementById('run-check-btn').disabled = true;
              document.getElementById('run-csv-btn').disabled = true;
            });
          </script>
        </div>
      </div>
    </div>
  </div>
{% endblock %}


