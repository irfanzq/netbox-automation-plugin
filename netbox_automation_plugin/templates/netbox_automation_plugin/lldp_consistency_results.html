{% extends 'base/layout.html' %}
{% load i18n %}
{% load render_table from django_tables2 %}
{% load form_helpers %}

{% block title %}{% trans "LLDP Consistency Check Results" %}{% endblock %}

{% block content %}
  <div class="row mb-3">
    <div class="col-md-12">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">{% trans "LLDP Consistency Check Summary" %}</h5>
          <small class="text-muted">Code executed at: {{ code_version }}</small>
        </div>
        <div class="card-body">
          <dl class="row mb-0">
            <dt class="col-md-3">{% trans "Devices checked" %}</dt>
            <dd class="col-md-3">{{ summary.device_count }}</dd>

            <dt class="col-md-3">{% trans "Interfaces with LLDP" %}</dt>
            <dd class="col-md-3">{{ summary.interface_count }}</dd>

            <dt class="col-md-3 text-success">{% trans "OK" %}</dt>
            <dd class="col-md-3 text-success">{{ summary.ok }}</dd>

            <dt class="col-md-3 text-warning">{% trans "Warnings" %}</dt>
            <dd class="col-md-3 text-warning">{{ summary.warning }}</dd>

            <dt class="col-md-3 text-danger">{% trans "Errors" %}</dt>
            <dd class="col-md-3 text-danger">{{ summary.error }}</dd>
          </dl>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-3">
    <div class="col-md-12">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">{% trans "LLDP Consistency Results" %}</h5>
          <button type="button" id="download-csv-btn" class="btn btn-sm btn-secondary">
            <i class="mdi mdi-download"></i>
            {% trans "Download CSV" %}
          </button>
        </div>
        <div class="card-body table-responsive">
          {% render_table table %}
        </div>
      </div>
      
      <!-- Hidden form for CSV export (uses cached results from session) -->
      <form method="post" id="csv-export-form" style="display: none;">
        {% csrf_token %}
        <input type="hidden" name="export_csv" value="1">
      </form>

      <script>
        document.getElementById('download-csv-btn').addEventListener('click', function() {
          // Submit the hidden form to trigger server-side CSV export from cached results
          document.getElementById('csv-export-form').submit();
        });
      </script>
    </div>
  </div>
{% endblock %}


